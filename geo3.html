<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Fit to the bounds of a LineString</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: rgb(59, 59, 59);
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            height: 50%;
        }
    </style>
</head>

<body>
    <style>
        .btn-control {
            font:
                bold 12px/20px 'Helvetica Neue',
                Arial,
                Helvetica,
                sans-serif;
            background-color: #3386c0;
            color: #fff;
            position: absolute;
            top: 20px;
            left: 50%;
            z-index: 1;
            border: none;
            width: 200px;
            margin-left: -100px;
            display: block;
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 3px;
        }

        .btn-control:hover {
            background-color: #4ea0da;
        }
    </style>
    <div>
    <div id="map"></div>
    <button id="zoomto" class="btn-control">Zoom to bounds</button>
</div>
    <div style="background-color: rgb(59, 59, 59); position: relative;
    top: 53vh;  height: 35vh; text-align: center;">
        <div>
            <h1  style="color: #c6c6c6;">mtr:  <span id="mtr" style="color: rgb(105, 200, 232);">959595</span>  </h3>
                <textarea id="teeext">

                </textarea>
        </div>
        <div>
            <button style="width: 100%; height: 15vh; border: solid 10px black ;border-radius: 20px;" click="stopSave();"> STOP </button>
        </div>
       
    </div>
    <div>
       
    </div>

    <script>//19.0253532,-98.2610225
    let options = {
  enableHighAccuracy: true,
  timeout: 5000,
  maximumAge: 0,
};

        mapboxgl.accessToken = 'pk.eyJ1IjoibWFyY29qcnp4IiwiYSI6ImNrNnNiN3pxbzA0YmozbXBhYmcwbzRlODIifQ.OWa3PQOhcF9vYvdunV5YEQ';
        // A GeoJSON object with a LineString route from the White House to Capitol Hill
        //[-98.2563381, 19.0149206],[-98.2563349, 19.0149512],[-98.2566937, 19.0154301],[-98.2555881, 19.0156364],[-98.2553385, 19.0157569],[-98.2552997, 19.0157667],[-98.2545264, 19.0160213],[-98.2532136, 19.0157635],[-98.2526997, 19.0160955],[-98.2526636, 19.0161849],[-98.2516116, 19.0167825],[-98.2515921, 19.0168071],[-98.2507902, 19.0173133],[-98.2509112, 19.0173363],[-98.2506205, 19.0181853],[-98.2507569, 19.0184791],[-98.2502009, 19.018238],[-98.2500647, 19.0178243],[-98.2498111, 19.0174193],[-98.2517387, 19.0142224],[-98.2517387, 19.0142224],[-98.2517387, 19.0142224],[-98.2517387, 19.0142224],[-98.247623, 19.0204977],[-98.2476204, 19.0204723],[-98.2476195, 19.020463],[-98.2449411, 19.0198092],[-98.2449384, 19.0198114],[-98.2445879, 19.0221954],[-98.2445379, 19.0222884],[-98.244516, 19.0223556],[-98.2445851, 19.0223372],[-98.2441839, 19.022535],[-98.242005, 19.0213116],[-98.2442374, 19.0225039],[-98.242171, 19.0212718],[-98.2432807, 19.0222674],[-98.2434745, 19.0224412],[-98.2436819, 19.0226273],[-98.2438255, 19.0227561],[-98.243899, 19.0228221],[-98.24376, 19.0227013],[-98.2437677, 19.0227088],[-98.2480363, 19.015291],[-98.2480373, 19.0152928],[-98.2417905, 19.0226987],[-98.2415941, 19.0229926],[-98.2410647, 19.0232356],[-98.2410447, 19.023239],[-98.2403591, 19.0235067],[-98.2392002, 19.0238353],[-98.2390614, 19.0238397],[-98.2388529, 19.0241485],[-98.2386101, 19.024674],[-98.2386076, 19.0246867],[-98.2385182, 19.0246707],[-98.2385555, 19.0247322],[-98.2385661, 19.0246845],[-98.2380501, 19.0250815],[-98.2380506, 19.0250943],[-98.2380457, 19.0250559],[-98.2380397, 19.0250593],[-98.2380809, 19.0250587],[-98.2380927, 19.0250541],[-98.2380239, 19.0250663],[-98.2380091, 19.02508],[-98.2380063, 19.0250797],[-98.2380214, 19.0250815],[-98.2374854, 19.0252608],[-98.2364109, 19.0259313],[-98.2364236, 19.0259353],[-98.2348218, 19.0267728],[-98.2348055, 19.0267926],[-98.2333524, 19.0272973],[-98.2315286, 19.0306731],[-98.2315299, 19.0306756],[-98.2291947, 19.0287203],[-98.2289567, 19.0289979],[-98.2290587, 19.0306701],[-98.2284076, 19.0307115],[-98.2281804, 19.0320559],[-98.2282215, 19.0321723],[-98.2282456, 19.0320887],[-98.2281602, 19.0321069],[-98.228157, 19.0321076],[-98.2278643, 19.0316308],[-98.2269002, 19.0333309],[-98.2270506, 19.0335859],[-98.22707, 19.0335745]
        let coordenadas = []
        
        const geojson = {
            'type': 'FeatureCollection',
            'features': [
                {
                    'type': 'Feature',
                    'geometry': {
                        'type': 'LineString',
                        'coordinates': coordenadas
                    },
                    'properties': {},
                }
            ]
        };

        const map = new mapboxgl.Map({
            container: 'map',
            // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
            style: 'mapbox://styles/mapbox/light-v11',
            center: [-98.2610955, 19.0201406],
            zoom: 12
        });

        map.on('load', () => {
            map.addSource('LineString', {
                'type': 'geojson',
                'data': geojson
            });
            map.addLayer({
                'id': 'LineString',
                'type': 'line',
                'source': 'LineString',
                'layout': {
                    'line-join': 'round',
                    'line-cap': 'round'
                },
                'paint': {
                    'line-color': '#BF93E4',
                    'line-width': 5
                }
            });

            document.getElementById('zoomto').addEventListener('click', () => {
                // Geographic coordinates of the LineString
                const coordinates = geojson.features[0].geometry.coordinates;

                // Create a 'LngLatBounds' with both corners at the first coordinate.
                const bounds = new mapboxgl.LngLatBounds(
                    coordinates[0],
                    coordinates[0]
                );

                // Extend the 'LngLatBounds' to include every coordinate in the bounds result.
                for (const coord of coordinates) {
                    bounds.extend(coord);
                }

                map.fitBounds(bounds, {
                    padding: 20
                });
            });

        });

    let saveData = true;
    let textarea = document.getElementById("teeext");
    let arregloAux = [];
    function stopSave() {
        saveData = false;
    }
    const watchID = navigator.geolocation.watchPosition((position) => {
        document.getElementById('mtr').innerHTML = "Metros: "+position.coords.accuracy+" <<< "; 
        console.log(" >>>> position.coords.latitude >> ",position.coords.latitude);
        console.log(" >>>> position.coords.longitude >> ",position.coords.longitude);
         if(saveData && position.coords.accuracy < 6) {
            arregloAux.push(position.coords.longitude);
            arregloAux.push(position.coords.latitude);
            geojson.features[0].geometry.coordinates.push(arregloAux);
            document.getElementById('teeext').value = JSON.stringify(arregloAux); 
            arregloAux = [];
            map.getSource('LineString').setData(geojson);
            document.getElementById('mtr').innerHTML = "Metros: "+position.coords.accuracy+" <<< "; 
            
         } else {
            arregloAux.push("STOP");
            document.getElementById('teeext').value = JSON.stringify(arregloAux); 
         }
        
            
        },() => {console.log("error") },options);
    </script>

</body>

</html>